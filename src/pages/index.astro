---
import Layout from '../layouts/Layout.astro';
import ContextAlert from '../components/ContextAlert.astro';
import Markdown from '../components/Markdown.astro';

const explainer = `
An Astro website can go way beyond static pages - on the right platform.

Netlify supports not only [Streaming SSR](https://docs.astro.build/en/guides/server-side-rendering/#html-streaming) and fast [Edge Middleware](https://docs.astro.build/en/guides/middleware/), but also [on-demand revalidation](https://www.netlify.com/blog/cache-tags-and-purge-api-on-netlify/) and [stale-while-revalidate](https://www.netlify.com/blog/swr-and-fine-grained-cache-control/). 
Any page or data can be rebuilt only when needed, without site visitors ever getting a performance hit.
`;
---

<Layout title="Welcome to Astro.">
    <ContextAlert class="mb-8" />
    <h1 class="mb-10">Netlify Platform Starter for Astro</h1>
    <Markdown content={explainer} class="mb-10 text-lg" />
    <p>
        <a href="https://docs.netlify.com/frameworks/astro/" class="btn btn-lg sm:min-w-64">Read the Docs</a>
    </p>
    <section>
        <h2 class="mb-4">推薦商品</h2>
        <ul id="recommendation-list" class="space-y-2"></ul>
    </section>

    <script type="module" client:load>
        window.RecommendationSDK?.getRecommendations({
            scenario: 'homepage',
            onSuccess: (products) => {
                const container = document.getElementById('recommendation-list');
                if (container && products?.length) {
                    console.log('Recommended products:', products);
                    container.innerHTML = products.map((item) => `<li>${item.name}</li>`).join('');
                }
                window.RecommendationSDK?.trackEvent('recommendation_impression', {
                    scenario: 'homepage',
                    items: products.map((p) => p.id)
                });
            },
            onError: (err) => {
                console.error('Recommendation error:', err);
            }
        });
    </script>
</Layout>
